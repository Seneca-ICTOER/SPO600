<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-F-AssemblyLanguage/inline-assembly-language">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/SPO600/img/pwa/icon-512x512.png">
<link rel="manifest" href="/SPO600/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/SPO600/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/SPO600/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/SPO600/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Inline Assembly Language | SPO600 - Software Portability and Optimization</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//SPO600/F-AssemblyLanguage/inline-assembly-language"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Inline Assembly Language | SPO600 - Software Portability and Optimization"><meta data-rh="true" name="description" content="Inline Assembly Language"><meta data-rh="true" property="og:description" content="Inline Assembly Language"><link data-rh="true" rel="icon" href="/SPO600/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//SPO600/F-AssemblyLanguage/inline-assembly-language"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//SPO600/F-AssemblyLanguage/inline-assembly-language" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//SPO600/F-AssemblyLanguage/inline-assembly-language" hreflang="x-default"><link rel="stylesheet" href="/SPO600/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/SPO600/assets/js/runtime~main.ad18d5de.js" as="script">
<link rel="preload" href="/SPO600/assets/js/main.6c09a687.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/SPO600/"><div class="navbar__logo"><img src="/SPO600/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/SPO600/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SPO600 - Software Portability and Optimization</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SPO600/">Welcome to SPO600</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SPO600/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/A-Classes/test-file">Classes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/B-Labs/lab1">Labs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/C-Projects/project">Projects</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/D-ExtraResources/course-policies">Extra Resources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/E-ComputerArchitecture/topic-file-1">Computer Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/SPO600/F-AssemblyLanguage/assembly-language">Assembly Language</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/assembly-language">Assembly Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/assembler-basics">Assembler Basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/SPO600/F-AssemblyLanguage/inline-assembly-language">Inline Assembly Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/executable-and-linkable-format">Executable and Linkable Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/symbol">Symbol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/syscalls">Syscalls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/aarch64-register-and-instruction-quick-start">AArch64 Register and Instruction Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SPO600/F-AssemblyLanguage/x86-64-register-and-instruction-quick-start">X86 64 Register and Instruction Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/H-ARM/armv8">ARM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SPO600/G-6502/topic-file-1">6502</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/SPO600/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Assembly Language</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Inline Assembly Language</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Inline Assembly Language</h1><p><em>Inline Assembly</em> is <a href="/SPO600/F-AssemblyLanguage/assembly-language">assembly language</a> code which is embedded in a program written in another language, typically C.</p><p>In open source software (especially in a Linux context), this is most commonly done using gcc, but inline assembler is also supported by llvm/clang, the Intel C compilers, Microsoft Visual Studio, and various other tools. Here we&#x27;re going to focus on gcc.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="syntax">Syntax<a class="hash-link" href="#syntax" title="Direct link to heading">​</a></h2><p>Inline assembler is included in a GCC C source file in one of these two forms:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">asm(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (...);                  // Those are double underscores!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If it is critical that the code not be moved by the compiler (for example, as the result of an optimization), include the keyword <code>volatile</code>:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">asm volatile (...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ __volatile__ (...);     // Double underscores all over the place</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Inside the parenthesis, there are up to four sections separated by colons. There are:</p><ol><li>The assembler template (mandatory)</li><li>Output operands (optional)</li><li>Input operands (optional)</li><li>Clobbers (optional)</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assembler-template">Assembler Template<a class="hash-link" href="#assembler-template" title="Direct link to heading">​</a></h3><p>The assembler template is a piece of assembler code that will be pre-processed to fill in register assignments. Registers may be referenced as %0, %1, %2 and so forth, indicating the registers mentioned in the output operands and input operands. For example, if there is one output operand and two input operands, you can refer to the register containing the output operand as <code>%0</code> and the input operands as <code>%1</code> and <code>%2</code>.</p><p>Because % is used as a prefix for register numbers (using some assembly language dialects), a double percent-sign must be used to represent a single percent sign in the code. For example, in x86_64 gas assembler, the rax register is written as <code>%rax</code> -- but in a template, it must be written as <code>%%rax</code>.</p><p>The template is written as one or more strings enclosed in quotes, with no separator other than whitespace between the strings. Individual statements in the asm code must be separated by semi-colons (;) or explicit newline characters (\n). The sequence \t can be used to indicate a tab character.</p><p>These are all valid:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">asm(&quot;mov %1,%0;inc %0&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %1,%0\ninc %0&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %1,%0\n&quot; &quot;inc %0&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %1,%0\n\t&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;inc $0&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These are not valid:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">asm(&quot;mov %1,%0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     inc %0&quot;);   // the assembler will not see a delimiter between the statements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %1,%0\n&quot;,&quot;inc %0&quot;);  // do not place a comma between the strings</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="output-and-input-operands">Output and Input Operands<a class="hash-link" href="#output-and-input-operands" title="Direct link to heading">​</a></h3><p>Output and input operands are optional -- some asm code may do a task without any input or output values.</p><p>If the asm code has input or output values, these operands are specified as an optional name in square brackets, a quoted string containing a constraint, and a C expression in parenthesis.</p><p>Constraints are specified as a string of characters. Some commonly use constraints are:</p><ul><li>r - any general-purpose register is permitted.</li><li>0-9 - the same register used in the matching number operand should be used (for example, &quot;1&quot; indicates that the same register should be used as operand 1).</li><li>i - an immediate integer value is permitted.</li><li>F - an immediate floating-point value is permitted.</li></ul><p>There are additional generic and platform-specific constraints (for example, for SIMD and floating-point registers). Refer to the gcc documentation for details (see <a href="#resources">resources</a>).</p><p>These constraints are combined with a modifier, required for output operands:</p><ul><li>= - output-only register - previous contents are discarded and replaced with output value (this does not preclude use as in input register)</li><li>+<!-- --> <!-- -->-<!-- --> input and output register - this register will be used to both pass input data to the asm code, and to receive a value from the asm code</li><li>&amp; - earlyclobber register - this value may be overwritten before input is processed, therefore it must not be used for input</li><li>% - in addition to one of the symbols above, declares that this operand and the following operand are commutable (interchangeable) for optimization. Only one commutable pair may be specified.</li></ul><p>The constraint is followed by a C expression in parenthesis to provide the value (input operand) or receive the value (output operand). This is usually a variable name for output operands, but may be a variable name, evaluated expression, or a constant for input operands.</p><p>Here are some (trivial) examples in x86_64 assembler:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int x=10, y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %1,%0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : &quot;=r&quot;(y)    // output register value is moved to y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // register is called %0 in template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : &quot;r&quot;(x)     // input value from x is placed in a register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // register is called %1 in template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, one or two registers are used for input and output -- the compiler can choose whether to use the same register for input and output, or to use separate ones. We can specify that only one register is to be used:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int x=10, y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %1,%0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : &quot;+r&quot;(y)       // + indicates read/write register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : &quot;0&quot;(x)        // output register is same as %0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The registers may be referenced by name instead of number if a name is provided in the operand sections:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int x=10, y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__asm__ (&quot;mov %[in],%[out]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : [out]&quot;=r&quot;(y)  // register may be called %[out]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : [in]&quot;r&quot;(x)    // register may be called %[in]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-a-specific-register-width-on-aarch64">Using a Specific Register Width on AArch64<a class="hash-link" href="#using-a-specific-register-width-on-aarch64" title="Direct link to heading">​</a></h3><p>On AArch64, you may need to access a 32-bit version of a register. To do this with templated register names, you can add the &#x27;w&#x27; modifier. For example, if %0 is x22 and you need to access w22, use %w0.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="constraining-an-operand-to-a-specific-register">Constraining an Operand to a Specific Register<a class="hash-link" href="#constraining-an-operand-to-a-specific-register" title="Direct link to heading">​</a></h3><p>It is sometimes useful to constrain an operand to a particular register to avoid having to perform moves within the asm code (for example, if an operand will be used as the input to a function call or <a href="/SPO600/F-AssemblyLanguage/syscalls">syscall</a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="register-constraints-using-explicit-register-variables">Register Constraints using Explicit Register Variables<a class="hash-link" href="#register-constraints-using-explicit-register-variables" title="Direct link to heading">​</a></h3><p>To select a specific register for a operand, use a (perhaps temporary) variable in operand&#x27;s C expression that is locked to a particular register in that variable&#x27;s C declaration, using <a href="http://gcc.gnu.org/onlinedocs/gcc-4.8.2/gcc/Local-Reg-Vars.html#Local-Reg-Vars" target="_blank" rel="noopener noreferrer">explicit register variables</a>.</p><p>For example, in aarch64 asm:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int x=10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">register int y asm(&quot;r15&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asm(&quot;mov %1,%0; inc r15;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : &quot;=r&quot;(y)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   : &quot;r&quot;(x)   // register r15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the variable y is constrained in C to the r15 register. The &quot;inc r15&quot; in the assembler template therefore increments the output register after the mov instructions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="i386-register-names">i386 Register Names<a class="hash-link" href="#i386-register-names" title="Direct link to heading">​</a></h3><p>On i386 only, specific registers may be selected by using <code>a</code>, <code>b</code>, <code>c</code>, or <code>d</code> in place of <code>r</code> as a register constraint. Using <code>a</code>, for example, will select the rax/eax register.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="clobber">Clobber<a class="hash-link" href="#clobber" title="Direct link to heading">​</a></h3><p>If your code will clobber (overwrite) registers or memory regions, these must be listed after the third colon within the asm parenthesis. For example:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">asm(&quot;...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    : &quot;=r&quot;(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    :  &quot;r&quot;(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    : &quot;rax&quot;, &quot;rbx&quot;, &quot;rsi&quot;   // values in rax, rbx, rsi will be clobbered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If memory is altered by the asm code, the string &quot;memory&quot; should be added to the clobber list. This will cause the compiler to mistrust values that were loaded from memory before the assembly language code was executed -- for example, if register r12 is loaded with an integer from memory before the assembly code is executed, it will be reloaded from memory afterward, because the value in memory may have been modified by the assembly code. If a memory clobber is not specified, the compiler will assume that values previously loaded from memory still match the values in memory. In most cases, the <code>volatile</code> keyword should be used along with the memory clobber flag.</p><p>If the condition code (status register or flag register) (ADD LINK) is altered, the string &quot;cc&quot; should be added to the clobber list.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a class="hash-link" href="#resources" title="Direct link to heading">​</a></h2><p>There are many other options applicable to special situations or specific architectures. All of these are documented here:</p><ul><li><a href="http://gcc.gnu.org/onlinedocs/gcc-4.8.2/gcc/Extended-Asm.html" target="_blank" rel="noopener noreferrer">GNU Assembler Manual</a><ul><li>Specifically, see the <a href="http://gcc.gnu.org/onlinedocs/gcc-4.8.2/gcc/Extended-Asm.html" target="_blank" rel="noopener noreferrer">Assembler Instructions with C Expression Operands</a> section</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/SPO600/tree/main/docs/F-AssemblyLanguage/inline-assembly-language.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/SPO600/F-AssemblyLanguage/assembler-basics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Assembler Basics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/SPO600/F-AssemblyLanguage/executable-and-linkable-format"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Executable and Linkable Format</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#syntax" class="table-of-contents__link toc-highlight">Syntax</a><ul><li><a href="#assembler-template" class="table-of-contents__link toc-highlight">Assembler Template</a></li><li><a href="#output-and-input-operands" class="table-of-contents__link toc-highlight">Output and Input Operands</a></li><li><a href="#using-a-specific-register-width-on-aarch64" class="table-of-contents__link toc-highlight">Using a Specific Register Width on AArch64</a></li><li><a href="#constraining-an-operand-to-a-specific-register" class="table-of-contents__link toc-highlight">Constraining an Operand to a Specific Register</a></li><li><a href="#register-constraints-using-explicit-register-variables" class="table-of-contents__link toc-highlight">Register Constraints using Explicit Register Variables</a></li><li><a href="#i386-register-names" class="table-of-contents__link toc-highlight">i386 Register Names</a></li><li><a href="#clobber" class="table-of-contents__link toc-highlight">Clobber</a></li></ul></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">SPO600 - Software Portability and Optimization</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/SPO600/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/SPO600/assets/js/runtime~main.ad18d5de.js"></script>
<script src="/SPO600/assets/js/main.6c09a687.js"></script>
</body>
</html>