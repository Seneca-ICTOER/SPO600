"use strict";(self.webpackChunkSPO600=self.webpackChunkSPO600||[]).push([[958],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return d}});var i=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=i.createContext({}),s=function(e){var t=i.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=s(a),d=n,g=m["".concat(p,".").concat(d)]||m[d]||c[d]||r;return a?i.createElement(g,l(l({ref:t},u),{},{components:a})):i.createElement(g,l({ref:t},u))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,l=new Array(r);l[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var s=2;s<r;s++)l[s]=a[s];return i.createElement.apply(null,l)}return i.createElement.apply(null,a)}m.displayName="MDXCreateElement"},2422:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return r},metadata:function(){return o},toc:function(){return s}});var i=a(3117),n=(a(7294),a(3905));const r={id:"rpm-packaging-process",title:"RPM Packaging Process",sidebar_position:12,description:"RPM Packaging Process"},l="RPM Packaging Process",o={unversionedId:"D-ExtraResources/rpm-packaging-process",id:"D-ExtraResources/rpm-packaging-process",title:"RPM Packaging Process",description:"RPM Packaging Process",source:"@site/docs/D-ExtraResources/rpm-packaging-process.md",sourceDirName:"D-ExtraResources",slug:"/D-ExtraResources/rpm-packaging-process",permalink:"/SPO600/D-ExtraResources/rpm-packaging-process",draft:!1,editUrl:"https://github.com/Seneca-ICTOER/SPO600/tree/main/docs/D-ExtraResources/rpm-packaging-process.md",tags:[],version:"current",sidebarPosition:12,frontMatter:{id:"rpm-packaging-process",title:"RPM Packaging Process",sidebar_position:12,description:"RPM Packaging Process"},sidebar:"courseNotesSidebar",previous:{title:"Screen Tutorial",permalink:"/SPO600/D-ExtraResources/screen-tutorial"},next:{title:"Remote X",permalink:"/SPO600/D-ExtraResources/remote-x"}},p={},s=[{value:"Resources",id:"resources",level:2},{value:"Setting up the Packaging Environment",id:"setting-up-the-packaging-environment",level:2},{value:"Needed Packages",id:"needed-packages",level:3},{value:"Setting up the RPM tree",id:"setting-up-the-rpm-tree",level:2},{value:"Wiping out the RPM tree",id:"wiping-out-the-rpm-tree",level:2},{value:"Examining Existing SRPMs",id:"examining-existing-srpms",level:2},{value:"Rebuild from SRPMS",id:"rebuild-from-srpms",level:2},{value:"Creating a New Package",id:"creating-a-new-package",level:2},{value:"Writing a specfile",id:"writing-a-specfile",level:3},{value:"Building the RPM",id:"building-the-rpm",level:2},{value:"Testing the RPM",id:"testing-the-rpm",level:2},{value:"Common Challenges",id:"common-challenges",level:2}],u={toc:s};function c(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,i.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"rpm-packaging-process"},"RPM Packaging Process"),(0,n.kt)("p",null,"RPM packages are built from the source files plus a spec file, using the ",(0,n.kt)("em",{parentName:"p"},"rpmbuild")," program."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Do Not Build as Root:")," Always build RPM packages as a regular, non-root user. Building as a root user is unnecessary and may cause unintended side effects, including damaging your system."),(0,n.kt)("h2",{id:"resources"},"Resources"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/PackageMaintainers"},"Fedora Package Maintainers page"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/PackageMaintainers/CreatingPackageHowTo"},"Packaging How-To")))),(0,n.kt)("li",{parentName:"ul"},"Fedora Linux chapter 5 (see Seneca Library website ",">"," eBooks ",">"," View All ",">"," Safari ",">"," Fedora Linux)."),(0,n.kt)("li",{parentName:"ul"},"rpmlint",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/Common_Rpmlint_issues"},"Fedora Common Rpmlint issues"))))),(0,n.kt)("h2",{id:"setting-up-the-packaging-environment"},"Setting up the Packaging Environment"),(0,n.kt)("h3",{id:"needed-packages"},"Needed Packages"),(0,n.kt)("p",null,"Install with ",(0,n.kt)("em",{parentName:"p"},"dnf")," (or ",(0,n.kt)("em",{parentName:"p"},"yum")," on older versions of Fedora):"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},'"Fedora Packager" (this is a group of packages - use "dnf groupinstall" or put an @ sign in front of the group name)'),(0,n.kt)("li",{parentName:"ul"},"rpmdevtools"),(0,n.kt)("li",{parentName:"ul"},"rpmlint"),(0,n.kt)("li",{parentName:"ul"},"yum-utils")),(0,n.kt)("h2",{id:"setting-up-the-rpm-tree"},"Setting up the RPM tree"),(0,n.kt)("p",null,"The directories used by the rpm build tools can be defined as RPM macros. A script is provided in the ",(0,n.kt)("em",{parentName:"p"},"rpmdevtools")," package to create a set of personal build directories and create the appropriate entries in the ",(0,n.kt)("inlineCode",{parentName:"p"},"~/.rpmmacros")," file:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-assembly"},"rpmdev-setuptree\n")),(0,n.kt)("p",null,"The directories created are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"~/rpmbuild/SOURCES - for source code (tarballs/zip archives and patches)"),(0,n.kt)("li",{parentName:"ul"},"~/rpmbuild/SPECS - for the spec file"),(0,n.kt)("li",{parentName:"ul"},"~/rpmbuild/SRPMS - for the resulting source RPMs"),(0,n.kt)("li",{parentName:"ul"},"~/rpmbuild/RPMS - for the resulting binary RPMs"),(0,n.kt)("li",{parentName:"ul"},"~/rpmbuild/BUILD - directory used to perform the build"),(0,n.kt)("li",{parentName:"ul"},'~/rpmbuild/BUILDROOT - contains a fake root directory into which the built files are "installed" prior to being packaged')),(0,n.kt)("h2",{id:"wiping-out-the-rpm-tree"},"Wiping out the RPM tree"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Wiping the Tree Deletes Data:")," Be sure to save any files you need from your previous build activity before wiping the tree."),(0,n.kt)("p",null,"When switching to a new package, it is customary to wipe out the ",(0,n.kt)("em",{parentName:"p"},"rpmbuild")," tree to avoid clutter: ",(0,n.kt)("inlineCode",{parentName:"p"},"rpmdev-wipetree")),(0,n.kt)("h2",{id:"examining-existing-srpms"},"Examining Existing SRPMs"),(0,n.kt)("p",null,"A great place to start when learning to build RPMs is to examine some existing SRPMs."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Download the source code for an existing RPM: ",(0,n.kt)("inlineCode",{parentName:"li"},"yumdownloader --source nameofpackage")),(0,n.kt)("li",{parentName:"ol"},"Install that downloaded SRPM (this does not require root access): ",(0,n.kt)("inlineCode",{parentName:"li"},"rpm -i nameofpackage*.src.rpm"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Source will be in ",(0,n.kt)("inlineCode",{parentName:"li"},"~/rpmbuild/SOURCES")),(0,n.kt)("li",{parentName:"ul"},"Spec file will be in ",(0,n.kt)("inlineCode",{parentName:"li"},"~/rpmbuild/SPECS"))))),(0,n.kt)("p",null,"After installing the SRPM you can:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Examine the specfile: ",(0,n.kt)("inlineCode",{parentName:"li"},"cd ~/rpmbuild/SPECS; less nameofpackage.spec")),(0,n.kt)("li",{parentName:"ul"},"Prep the sources (unpack tarballs, apply patches) to see the source code as it will be built: ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmbuild -bp nameofpackage.spec")," # Results will be in ",(0,n.kt)("inlineCode",{parentName:"li"},"~/rpmbuild/BUILD/")," (usually in a subdirectory named ",(0,n.kt)("inlineCode",{parentName:"li"},"nameofpackage-version"),")."),(0,n.kt)("li",{parentName:"ul"},"Build from source using the specfile:",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Build all (binary RPMS plus SRPMS): ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmbuild -ba nameofpackage.spec")),(0,n.kt)("li",{parentName:"ol"},"Build just the spec file: ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmbuild -bs nameofpackage.spec"))))),(0,n.kt)("h2",{id:"rebuild-from-srpms"},"Rebuild from SRPMS"),(0,n.kt)("p",null,"Instead of installing an SRPM and building from the spec file, it is possible to build the binary RPMs and SRPM directly from an SRPM:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-assembly"},"rpmbuild --rebuild nameofpackage*.src.rpm\n")),(0,n.kt)("p",null,"This is useful when a no binary package is available for a particular platform or distribution version, but an SRPM is available."),(0,n.kt)("h2",{id:"creating-a-new-package"},"Creating a New Package"),(0,n.kt)("h3",{id:"writing-a-specfile"},"Writing a specfile"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Run ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmdev-newspec packagename")," in ~/rpmbuild/SPECS"),(0,n.kt)("li",{parentName:"ol"},"Edit the skeleton specfile. Refer to the ",(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/PackageMaintainers/CreatingPackageHowTo"},"Packaging How-To")," for guidance.")),(0,n.kt)("h2",{id:"building-the-rpm"},"Building the RPM"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"rpmbuild -ba packagename.spec"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"If successful, output will be binary RPM(s) in ",(0,n.kt)("inlineCode",{parentName:"li"},"~/rpmbuild/RPMS")," and source RPM in ",(0,n.kt)("inlineCode",{parentName:"li"},"~/rpmbuild/SRPMS"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"You can install binary RPM as root using this command: ",(0,n.kt)("inlineCode",{parentName:"li"},"rpm -i rpmfile")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"yum localinstall rpmfile")))),(0,n.kt)("li",{parentName:"ul"},"If unsuccessful, read the error messages carefully.")))),(0,n.kt)("p",null,"Note that a successful build of a compiled binary will usually produce both a binary RPM and a ",(0,n.kt)("em",{parentName:"p"},"debuginfo")," RPM. The debuginfo package contains additional information which is useful for debugging a problem, but which just takes up space when the program is being used normally."),(0,n.kt)("p",null,"Some spec files may produce multiple packages -- for example, they may produce separate packages for a game, game data, and documentation; or for a base package and additional plugins for use with that package; or for a base package and multiple user interfaces (such as separate command-line, graphical, and web interfaces). This is done at the discretion of the spec file author where she decides that the user may want to install a subset of the package's features."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Building to Different Points:")," The ",(0,n.kt)("inlineCode",{parentName:"p"},"-ba"),' argument means "build all". You can substitute different values to build to different points in the process: ',(0,n.kt)("inlineCode",{parentName:"p"},"-bp")," to build to the prep stage, ",(0,n.kt)("inlineCode",{parentName:"p"},"-bs"),' to build only a SRPM, and so forth. See the manpage for <rpmbuild" for details.'),(0,n.kt)("h2",{id:"testing-the-rpm"},"Testing the RPM"),(0,n.kt)("p",null,"The rpmlint tool tests spec files, source RPMs, and binary RPMs to verify that they were created in compliance with the Fedora packaging guidelines."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Test the spec file: ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmlint ~/rpmbuild/SPECS/packagename*")),(0,n.kt)("li",{parentName:"ul"},"Test the source RPM: ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmlint ~/rpmbuild/SRPMS/packagename*.src.rpm")),(0,n.kt)("li",{parentName:"ul"},"Test the binary RPMs: ",(0,n.kt)("inlineCode",{parentName:"li"},"rpmlint ~/rpmbuild/RPMS/*/packagename*.rpm"))),(0,n.kt)("p",null,'Notice that the checks performed vary based on the input file. For example, some errors in the spec file (such as the summary ending in a period ".") could be determined from the spec file, but only show up when the SRPM/RPM is checked. Each run will report the number of errors and warnings; errors are serious problems which should not be ignored, while warnings may be ignored depending on the context.'),(0,n.kt)("p",null,"If you discover any errors, edit the specfile to correct them. If you need additional information on the error:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"add the -i (information) option to the ",(0,n.kt)("em",{parentName:"li"},"rpmlint")," command"),(0,n.kt)("li",{parentName:"ul"},"see the ",(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/Common_Rpmlint_issues"},"Fedora Common Rpmlint issues")," page on the Fedora wiki")),(0,n.kt)("h2",{id:"common-challenges"},"Common Challenges"),(0,n.kt)("p",null,"Refer to these documents on the Fedora wiki for help on specific packaging challenges:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/Packaging:Guidelines"},"Packaging Guidelines")," - General packaging guidelines for Fedora, including instructions for specific languages and packaging cases"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/Packaging:ScriptletSnippets"},"Scriptlet Snippets")," - Script(lets) that can be used in RPM packages to solve specific problems")),(0,n.kt)("p",null,"In particular, these sections are useful for GNU software:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/Packaging:ScriptletSnippets#Texinfo"},"Packaging .info (texinfo) documentation files")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://fedoraproject.org/wiki/Packaging:Guidelines#Handling_Locale_Files"},"Handling locale files (message translations)"))))}c.isMDXComponent=!0}}]);