"use strict";(self.webpackChunkSPO600=self.webpackChunkSPO600||[]).push([[8499],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return g}});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var o=n.createContext({}),m=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=m(e.components);return n.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,i=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=m(a),g=s,d=p["".concat(o,".").concat(g)]||p[g]||c[g]||i;return a?n.createElement(d,r(r({ref:t},u),{},{components:a})):n.createElement(d,r({ref:t},u))}));function g(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=a.length,r=new Array(i);r[0]=p;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:s,r[1]=l;for(var m=2;m<i;m++)r[m]=a[m];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},2030:function(e,t,a){a.r(t),a.d(t,{assets:function(){return o},contentTitle:function(){return r},default:function(){return c},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return m}});var n=a(3117),s=(a(7294),a(3905));const i={id:"assembler-basics",title:"Assembler Basics",sidebar_position:2,description:"Assembler Basics"},r="Assembler Basics",l={unversionedId:"F-AssemblyLanguage/assembler-basics",id:"F-AssemblyLanguage/assembler-basics",title:"Assembler Basics",description:"Assembler Basics",source:"@site/docs/F-AssemblyLanguage/assembler-basics.md",sourceDirName:"F-AssemblyLanguage",slug:"/F-AssemblyLanguage/assembler-basics",permalink:"/SPO600/F-AssemblyLanguage/assembler-basics",draft:!1,editUrl:"https://github.com/Seneca-ICTOER/SPO600/tree/main/docs/F-AssemblyLanguage/assembler-basics.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"assembler-basics",title:"Assembler Basics",sidebar_position:2,description:"Assembler Basics"},sidebar:"courseNotesSidebar",previous:{title:"Assembly Language",permalink:"/SPO600/F-AssemblyLanguage/assembly-language"},next:{title:"Inline Assembly Language",permalink:"/SPO600/F-AssemblyLanguage/inline-assembly-language"}},o={},m=[{value:"Format of an Assembly Language program",id:"format-of-an-assembly-language-program",level:2},{value:"6502 Assembly Language in the Emulator",id:"6502-assembly-language-in-the-emulator",level:2},{value:"Assembly Language on a Linux System",id:"assembly-language-on-a-linux-system",level:2},{value:"Compiling an Assembly Language Program using the GNU Assembler",id:"compiling-an-assembly-language-program-using-the-gnu-assembler",level:3},{value:"Compiling an Assembly Language Program using the NASM Assembler",id:"compiling-an-assembly-language-program-using-the-nasm-assembler",level:3},{value:"Compiling an Assembly Language program using GCC",id:"compiling-an-assembly-language-program-using-gcc",level:3},{value:"Instruction Set Architecture Information",id:"instruction-set-architecture-information",level:3},{value:"Resources",id:"resources",level:2}],u={toc:m};function c(e){let{components:t,...a}=e;return(0,s.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"assembler-basics"},"Assembler Basics"),(0,s.kt)("p",null,"When you program in ",(0,s.kt)("a",{parentName:"p",href:"/SPO600/F-AssemblyLanguage/assembly-language"},"assembly language"),", you're directly programming the \"bare metal\" hardware. This means that many of the compile-time and run-time checks, error messages, and diagnostics that are present in other languages are not available. The computer will follow your instructions exactly, even if they are completely wrong (like executing data), and when something goes wrong, your program won't terminate until it tries to do something that's not permitted, such as execute an invalid opcode or attempt to access a protected or unmapped region of memory. When that happens, the CPU will signal an exception, and in most cases the operating system will shut down the offending process."),(0,s.kt)("h2",{id:"format-of-an-assembly-language-program"},"Format of an Assembly Language program"),(0,s.kt)("p",null,"The traditional extension for assembly-language source files is ",(0,s.kt)("inlineCode",{parentName:"p"},".s")," (e.g., ",(0,s.kt)("inlineCode",{parentName:"p"},"example.s"),"), or ",(0,s.kt)("inlineCode",{parentName:"p"},".S")," for files that need to go through the C preprocessor (",(0,s.kt)("inlineCode",{parentName:"p"},"cpp"),")."),(0,s.kt)("p",null,"An assembly-language program consists of:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("a",{parentName:"li",href:"/SPO600/F-AssemblyLanguage/symbol"},"Symbols")," that are constants which correspond to memory addresses, registers, or other values."),(0,s.kt)("li",{parentName:"ol"},"Instructions - Mnemonics for an operations, each followed by zero or more arguments."),(0,s.kt)("li",{parentName:"ol"},"Data - Values used by the program for things such as initial variable values and string or numeric constants.")),(0,s.kt)("p",null,"Assembler ",(0,s.kt)("strong",{parentName:"p"},"directives")," are used to control the assembly of the code, by specifying output file sections (such as .text (machine code), .data (read/write data), or .rodata (read-only data/constants) in an ELF file) and data formats (such as word size for numeric values), and by defining macros."),(0,s.kt)("p",null,'Consider this x86_64 assembly language "Hello World" program:'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-assembly"},'.text\n.global  _start\n\nstdout = 1\n\n_start:\n        mov    $len,%rdx                       /* message length */\n        mov    $msg,%rsi                       /* message location */\n        mov    $stdout,%rdi                    /* file descriptor stdout */\n        mov    $1,%rax                         /* syscall sys_write */\n        syscall\n\n        mov    $0,%rdi                         /* exit status */\n        mov    $60,%rax                        /* syscall sys_exit */\n        syscall\n\n.rodata\n\nmsg:    .ascii      "Hello, world!\\n"\n.set len , . - msg\n')),(0,s.kt)("p",null,"In this program, which was written using GNU Assembler (gas) syntax, text is coloured according to its type:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"directives"),(0,s.kt)("li",{parentName:"ul"},"instructions"),(0,s.kt)("li",{parentName:"ul"},"symbols"),(0,s.kt)("li",{parentName:"ul"},"expressions"),(0,s.kt)("li",{parentName:"ul"},"other syntax elements, such as prefixes and delimiters")),(0,s.kt)("p",null,"In GNU assembler, a symbol may be set in one of three ways:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Using the ",(0,s.kt)("inlineCode",{parentName:"li"},".set")," directive (in the example above, len line)"),(0,s.kt)("li",{parentName:"ol"},"Using an assignment using an equals sign (in the example above, stdout line), which the GNU assembler treats as an alternative syntax for the ",(0,s.kt)("inlineCode",{parentName:"li"},".set")," directive"),(0,s.kt)("li",{parentName:"ol"},"As a label (such as _start or msg in the example above). A label set in this way is identified by the trailing colon, and is set to the current memory location in the instruction or data sequence. Labels may be used for loading/storing information, or as the target of branches/jumps.")),(0,s.kt)("p",null,"In the program above:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},'.text is a directive (equivalent to the longer directive ".section .text") which specifies that the following instructions/data should be placed in the ".text" section of the output ELF file.'),(0,s.kt)("li",{parentName:"ul"},".rodata is a similar directive which specifies that the following instructions/data should be placed in the .rodata section of the output ELF file. In the case of this program, they could alternately be placed in the .data section, which is for read-write data (data which is write-protected in memory), but .rodata was used because the string is not modified by the program (it's a constant)."),(0,s.kt)("li",{parentName:"ul"},".global (or .globl) is a directive which makes the following symbol visible to the linker. Otherwise, symbols are normally lost by link time. In this case, the linker needs to know the value of the special symbol _start in order to know where execution is to begin in the program (which is not always at the start of the .text section)."),(0,s.kt)("li",{parentName:"ul"},"_start is a label which is equivalent to the memory location of the first instruction in the program."),(0,s.kt)("li",{parentName:"ul"},'msg is a label which is equivalent to the memory location of the first byte of the string "Hello, World!\\n"'),(0,s.kt)("li",{parentName:"ul"},'.set is a directive which sets a symbol (len) equal to the value of an expression (in this example, ". - msg" meaning the current memory location minus the value of the label "msg"). Note that the GNU assembler accepts ',(0,s.kt)("inlineCode",{parentName:"li"},"a=1")," as equivalent to ",(0,s.kt)("inlineCode",{parentName:"li"},".set a, 1")," -- both are counted as directives regardless of the presence of the ",(0,s.kt)("inlineCode",{parentName:"li"},".set")," keyword.")),(0,s.kt)("p",null,"Note that symbols are not variables - they are constants that are calculated at compile-time. However, they may contain an address at which a variable is stored."),(0,s.kt)("p",null,"Note also that the syntax will vary from assembler to assembler and from architecture to architecture."),(0,s.kt)("h2",{id:"6502-assembly-language-in-the-emulator"},"6502 Assembly Language in the Emulator"),(0,s.kt)("p",null,"The 6502 Emulator (ADD LINK) provides a very simple assembler for 6502 (ADD LINK) code:"),(0,s.kt)("p",null,"Simple text-substitution macros can be defined with ",(0,s.kt)("inlineCode",{parentName:"p"},"define name value")," like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-assembly"}," define SCREEN $f000\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The DCB (Declare Constant Byte) directive can be used to create a group of bytes in memory. Byte values are comma-separated and may be double-quoted single printable characters (except space, double quote, or comma), decimal values, or hexadecimal values prefixed with $, like this:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-assembly"},' dcb 12,34,56\n dcb $33,$66,$CC,$FF\n dcb "A"\n dcb "T","e","s","t",$20,"4",".",0\n')),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The current assembly pointer starts at $0600 and increments with output bytes; it can be changed with this syntax:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-assembly"}," *=$0800\n")),(0,s.kt)("p",null,"To create an assembly language program in the emulator, simply type or paste the code in the text area and hit Assemble. If no error messages are output, the Run button will be enabled, and pressing that will run your code. To save your code, copy and paste it from the text area into an editor."),(0,s.kt)("h2",{id:"assembly-language-on-a-linux-system"},"Assembly Language on a Linux System"),(0,s.kt)("p",null,"On a Linux system, you will need to meet three requirements to get your assembly language program to work:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Code must be placed in the ",(0,s.kt)("inlineCode",{parentName:"li"},".text")," section of the ELF file."),(0,s.kt)("li",{parentName:"ol"},"Data must be placed in either the ",(0,s.kt)("inlineCode",{parentName:"li"},".rodata")," (read-only data) or ",(0,s.kt)("inlineCode",{parentName:"li"},".data")," (read/write data) sections of the ELF file."),(0,s.kt)("li",{parentName:"ol"},"There must be a globally-defined symbol which the linker (",(0,s.kt)("inlineCode",{parentName:"li"},"ld"),") will use to find the entry point to your program. If the code is being directly compiled by the assembler, this symbol must be ",(0,s.kt)("inlineCode",{parentName:"li"},"_start")," -- but if the code is being compiled by gcc, this symbol must be called ",(0,s.kt)("inlineCode",{parentName:"li"},"main")," (a preamble will be located at ",(0,s.kt)("inlineCode",{parentName:"li"},"_start")," which will then transfer control to ",(0,s.kt)("inlineCode",{parentName:"li"},"main"),").")),(0,s.kt)("p",null,"The file extension should be ",(0,s.kt)("inlineCode",{parentName:"p"},".s")," for assembler source without directives (for compilation with the assembler) or ",(0,s.kt)("inlineCode",{parentName:"p"},".S")," for assembler with preprocessor directives (for compilation with gcc)."),(0,s.kt)("h3",{id:"compiling-an-assembly-language-program-using-the-gnu-assembler"},"Compiling an Assembly Language Program using the GNU Assembler"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Run the assembler: ",(0,s.kt)("inlineCode",{parentName:"li"},"as -g -o test.o test.s")),(0,s.kt)("li",{parentName:"ol"},"Run the linker: ",(0,s.kt)("inlineCode",{parentName:"li"},"ld -o test test.o"))),(0,s.kt)("p",null,"Note that the ",(0,s.kt)("inlineCode",{parentName:"p"},"-g")," option assembles the program with symbolic debugging information included."),(0,s.kt)("h3",{id:"compiling-an-assembly-language-program-using-the-nasm-assembler"},"Compiling an Assembly Language Program using the NASM Assembler"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Run the assembler: ",(0,s.kt)("inlineCode",{parentName:"li"},"nasm -g -f elf64 -o test.o test.s")),(0,s.kt)("li",{parentName:"ol"},"Run the linker: ",(0,s.kt)("inlineCode",{parentName:"li"},"ld -o test test.o"))),(0,s.kt)("p",null,"Notes:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"NASM only works with x86 code."),(0,s.kt)("li",{parentName:"ol"},"The source file must be written using NASM syntax (which is substantially different from the GNU assembler syntax)."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"-f elf64")," option instructs NASM to assemble the code for a 64-bit target (x86_64)."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"-g")," option assembles the program with symbolic debugging information included.")),(0,s.kt)("h3",{id:"compiling-an-assembly-language-program-using-gcc"},"Compiling an Assembly Language program using GCC"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Run the preprocessor, assembler, and linker using the gcc command: ",(0,s.kt)("inlineCode",{parentName:"li"},"gcc -g -o test.o test.S"))),(0,s.kt)("p",null,"Note that the ",(0,s.kt)("inlineCode",{parentName:"p"},"-g")," option assembles the program with symbolic debugging information included, and that the normal GCC optimization options are not available."),(0,s.kt)("h3",{id:"instruction-set-architecture-information"},"Instruction Set Architecture Information"),(0,s.kt)("p",null,"To get started with specific instruction set architectures (ADD LINK), see:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/SPO600/F-AssemblyLanguage/x86-64-register-and-instruction-quick-start"},"x86_64 Register and Instruction Quick Start")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/SPO600/F-AssemblyLanguage/aarch64-register-and-instruction-quick-start"},"aarch64 Register and Instruction Quick Start"))),(0,s.kt)("h2",{id:"resources"},"Resources"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://sourceware.org/binutils/docs/as/"},"Using as, The GNU Assembler")," (GAS manual)")))}c.isMDXComponent=!0}}]);